# Default values for complex-k8s.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

worker:
  enabled: true
  image: aleksaspielikis/multi-worker

client:
  enabled: true
  replicas: 3
  image: aleksaspielikis/multi-client

server:
  enabled: true
  replicas: 3
  image: aleksaspielikis/multi-server

redis:
  enabled: true
  clusterPort: 6379

metricbeat:
  enabled: true

filebeat:
  enabled: true
  autodiscover:
    providers:
      - type: kubernetes
        templates:
          - condition.contains:
              kubernetes.labels:
                component: redis
            config:
              - module: redis
                log:
                  input:
                    type: docker
                    containers.ids:
                      - ${data.kubernetes.container.id}
                slowlog:
                  enabled: true
                  var.hosts: ["${data.host}:${data.port}"]

kibana:
  enabled: true
  server:
    basePath: /kibana
    rewriteBasePath: true
  extraEnvs:
  - name: SERVER_BASEPATH
    value: /kibana

elasticsearch:
  enabled: true
  antiAffinity: "soft"
  
  volumeClaimTemplate:
    resources:
      requests:
        storage: 10Gi

postgres:
  enabled: true
  clusterPort: 5432
  storage: 2Gi
  secretKeyRef:
    name: pgpassword
    key: PGPASSWORD

ingress:
  enabled: true
  annotations:
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/rewrite-target: /$1    
    nginx.ingress.kubernetes.io/configuration-snippet: |
      rewrite ^/kibana/?(.*)$ /$1 break;
      proxy_set_header Authorization "";
  expose:
    client:
      path: /?(.*)
      clusterPort: 3000
    kibana:
      path: /kibana/?(.*)
      clusterPort: 5601
    server:
      path: /api/?(.*)
      clusterPort: 5000
